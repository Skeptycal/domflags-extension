// Generated by CoffeeScript 1.6.3
var updateContextMenus,
  __hasProp = {}.hasOwnProperty;

updateContextMenus = function(flags) {
  var key, value, _results;
  chrome.contextMenus.removeAll();
  if (flags.length > 0) {
    _results = [];
    for (key in flags) {
      if (!__hasProp.call(flags, key)) continue;
      value = flags[key];
      _results.push(chrome.contextMenus.create({
        title: value,
        id: "" + key,
        contexts: ['all']
      }));
    }
    return _results;
  }
};

chrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {
  updateContextMenus(message.flags);
  return chrome.runtime.onConnect.addListener(function(port) {
    var onClickHandler;
    onClickHandler = function(info, tab) {
      return port.postMessage({
        key: info.menuItemId
      });
    };
    return chrome.contextMenus.onClicked.addListener(onClickHandler);
  });
});

chrome.tabs.onActivated.addListener(function(activeInfo) {
  return chrome.tabs.sendMessage(activeInfo.tabId, "give me domflags", function(response) {
    if (response) {
      return updateContextMenus(response.flags);
    }
  });
});
