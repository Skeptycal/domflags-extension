(function(){var e,t,s=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};this.toggleDomflag=function(e){return e.hasAttribute("domflag")?e.removeAttribute("domflag",""):e.setAttribute("domflag","")},e=1,new(t=function(){function t(){this.domflags=void 0,this.domflagsPanel=void 0,this.panelList=void 0,this.shadowRoot=void 0,this.modifiedNodes=void 0,this.observer=void 0,this.flagStrings=[],this.observerVars={attributes:!0,attributeFilter:["domflag"],attributeOldValue:!1,childList:!0,subtree:!0},this.setupDomObserver(),this.observer.observe(document.body,this.observerVars),this.backgroundListener()}return t.prototype._cacheDomflagsPanel=function(){return null!=this.shadowRoot?this.domflagsPanel=this.shadowRoot.getElementById("domflags-panel"):this.appendDomflagsPanel()},t.prototype._cacheDomflags=function(){return this.domflags=document.querySelectorAll("[domflag]")},t.prototype._calibrateIndexes=function(){var e,t,s,o,a,n;for(a=this._getPanelItems(),n=[],e=s=0,o=a.length;o>s;e=++s)t=a[e],n.push(t.setAttribute("data-key",e));return n},t.prototype._getPanelItems=function(){return this.domflagsPanel.getElementsByClassName("domflags-li")},t.prototype._elToString=function(e){var t,s,o;return o=e.tagName.toLowerCase(),s=e.id?"#"+e.id:"",t=e.className?"."+e.className:"",o+s+t},t.prototype.backgroundListener=function(){return chrome.runtime.onMessage.addListener(function(e){return function(t){if("remove"===t){if(e.observer.disconnect(),null==e.domflagsPanel)return;e.domflagsPanel.parentNode.removeChild(e.domflagsPanel),e._cacheDomflagsPanel()}return"create"===t&&null==e.domflagsPanel?(e._cacheDomflags(),e.domflags.length>0&&e.addNodesToPanel(e.domflags),e.observer.observe(document.body,e.observerVars)):void 0}}(this))},t.prototype.appendDomflagsPanel=function(){var e,t,s,o;return e=chrome.extension.getURL("src/inject/inject.css"),o='<style type="text/css" media="screen">@import url('+e+");</style>",t='<domflags-panel id="domflags-panel" class="bottom left opened">\n  <domflags-header class="domflags-header">DOMFLAGS</domflags-header>\n  <domflags-button class="domflags-button right"></domflags-button>\n  <domflags-ol class="domflags-ol"></domflags-ol>\n</domflags-panel>',null==document.getElementById("domflags-root")&&(s=document.createElement("domflags"),s.setAttribute("id","domflags-root"),document.body.appendChild(s,document.body.childNodes[0]),this.shadowRoot=document.getElementById("domflags-root").createShadowRoot(),this.shadowRoot.innerHTML=o),this.shadowRoot.innerHTML+=t,this._cacheDomflagsPanel(),this.panelList=this.domflagsPanel.getElementsByClassName("domflags-ol")[0],this.createPanelListeners()},t.prototype.createPanelListeners=function(){var e,t,s;return this.domflagsPanel.addEventListener("click",function(){return function(o){switch(o.target.classList[0]){case"domflags-li":return t(o);case"domflags-header":return e();case"domflags-button":return s(o)}}}(this)),t=function(e){var t;return t=e.target.getAttribute("data-key"),chrome.runtime.sendMessage({name:"panelClick",key:t})},e=function(e){return function(){var t,s,o,a;return t={remove:"opened",add:"closed",height:e.panelList.offsetHeight+1},o={remove:"closed",add:"opened",height:0},a=function(){switch(!1){case!this.domflagsPanel.classList.contains("opened"):return t;case!this.domflagsPanel.classList.contains("closed"):return o}}.call(e),s=a.height,e.domflagsPanel.classList.remove(a.remove),e.domflagsPanel.classList.add(a.add),$(e.domflagsPanel).css("transform","translateY("+s+"px)")}}(this),s=function(e){return function(t){var s,o;switch(o=t.target.classList[1]){case"left":s="right";break;case"right":s="left"}return e.domflagsPanel.classList.remove(s),e.domflagsPanel.classList.add(o),t.target.classList.remove(o),t.target.classList.add(s)}}(this)},t.prototype.addNodesToPanel=function(e){var t,s,o,a,n,r,l,i,d;for(r=function(e){return function(t){return e.panelList.innerHTML+=t}}(this),d=function(e,t){return t>0?$(n[t-1]).after(e):$(n[0]).before(e)},null==this.domflagsPanel&&this.appendDomflagsPanel(),n=this._getPanelItems(),l=0,i=e.length;i>l;l++){if(a=e[l],!a.hasAttribute("domflag"))return;switch(s=this._elToString(a),this._cacheDomflags(),o=[].indexOf.call(this.domflags,a),this.flagStrings.splice(o,0,s),t="<domflags-li class='domflags-li' data-key='"+o+"'>"+s+"</domflags-li>",!1){case!(n.length>0):d(t,o);break;default:r(t)}}return this._calibrateIndexes()},t.prototype.removeNodesFromPanel=function(e){var t,s,o,a,n,r,l;if(this._cacheDomflagsPanel(),null!=this.domflagsPanel){for(a=this._getPanelItems(),l=e.slice(0).reverse(),n=0,r=l.length;r>n;n++)s=l[n],t=[].indexOf.call(this.domflags,s),this.flagStrings.splice(t,1),o=a[t],null!=o&&o.parentNode.removeChild(o);return this._cacheDomflags(),this._calibrateIndexes()}},t.prototype.setupDomObserver=function(){return this.observer=new MutationObserver(function(e){return function(t){var s,o,a;for(e.modifiedNodes={"new":[],deleted:[]},o=0,a=t.length;a>o;o++)switch(s=t[o],s.type){case"childList":e.parseChildList(s);break;case"attributes":e.parseAttrs(s)}return e.modifiedNodes.deleted.length>0&&e.removeNodesFromPanel(e.modifiedNodes.deleted),e.modifiedNodes["new"].length>0?e.addNodesToPanel(e.modifiedNodes["new"]):void 0}}(this))},t.prototype.parseChildList=function(t){var o,a,n,r,l,i,d,f,c;if(o={mutation:t.addedNodes,panelArray:this.modifiedNodes["new"]},l={mutation:t.removedNodes,panelArray:this.modifiedNodes.deleted},n=function(){switch(!1){case!(o.mutation.length>0):return o;case!(l.mutation.length>0):return l}}(),r=function(e){return s.call(n.panelArray,e)<0?n.panelArray.push(e):void 0},null!=n){for(f=n.mutation,c=[],i=0,d=f.length;d>i;i++)a=f[i],a.nodeType===e&&(a.hasAttribute("domflag")&&r(a),c.push(function(){var e,t,s,o;for(s=a.querySelectorAll("[domflag]"),o=[],e=0,t=s.length;t>e;e++)a=s[e],o.push(r(a));return o}()));return c}},t.prototype.parseAttrs=function(e){return e.target.hasAttribute("domflag")?this.modifiedNodes["new"].push(e.target):this.modifiedNodes.deleted.push(e.target)},t}())}).call(this);