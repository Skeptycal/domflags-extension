// Generated by CoffeeScript 1.6.3
var init,
  __hasProp = {}.hasOwnProperty;

$(document).ready(function() {
  return init();
});

init = function() {
  var $domflags, domArray, domString, domTag, flagElements, key;
  $domflags = $('[domflag]');
  flagElements = [];
  if ($domflags.length > 0) {
    for (key in $domflags) {
      if (!__hasProp.call($domflags, key)) continue;
      if ($.isNumeric(key)) {
        domTag = $domflags[key].tagName;
        domArray = [domTag];
        Array.prototype.slice.call($domflags[key].attributes).forEach(function(item) {
          if (item.name !== "domflag") {
            return domArray.push("" + item.name + "='" + item.value + "'");
          }
        });
        domString = domArray.join(' ');
        flagElements.push(domString);
      }
    }
    chrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {
      var $domPanel, el, elements, html, value;
      if (message === "Remove panel") {
        return $('#domflags').remove();
      } else if (message === "Give me domflags") {
        sendResponse({
          flags: flagElements
        });
        if (!$('#domflags').is(":visible")) {
          elements = "";
          for (key in flagElements) {
            if (!__hasProp.call(flagElements, key)) continue;
            value = flagElements[key];
            if ($.isNumeric(key)) {
              el = "<domflag-li data-key='" + key + "'>" + value + "</domflag-li>";
              elements = "" + elements + " " + el;
            }
          }
          html = "<domflag-panel id=\"domflags\" class=\"opened\">\n  <domflag-header id=\"header\">DOMFLAGS</domflag-header>\n  <domflag-ol>\n    " + elements + "\n  </domflag-ol>\n</domflag-panel>";
          $('body').append(html);
          $domPanel = $('#domflags');
          $domPanel.on('click', 'domflag-li', function(event) {
            key = $(this).attr('data-key');
            return chrome.runtime.sendMessage({
              name: "panelClick",
              key: key
            });
          });
          return $domPanel.on('click', 'domflag-header', function(event) {
            var listHeight;
            if ($domPanel.hasClass('opened')) {
              listHeight = $domPanel.find('domflag-ol').outerHeight() + 1;
              $domPanel.removeClass('opened').addClass('closed');
              return $domPanel.css('transform', "translateY(" + listHeight + "px)");
            } else if ($domPanel.hasClass('closed')) {
              $domPanel.removeClass('closed').addClass('opened');
              return $domPanel.css('transform', "translateY(0px)");
            }
          });
        }
      }
    });
    return chrome.runtime.sendMessage({
      name: "pageReloaded"
    });
  }
};
