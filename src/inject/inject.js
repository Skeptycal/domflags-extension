(function(){var e,t,s,o=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};this.toggleDomflag=function(e){return e.hasAttribute("domflag")?e.removeAttribute("domflag",""):e.setAttribute("domflag","")},e=1,t=9,new(s=function(){function s(){this.domflags=[],this._restorePersistedDomflags(),this._cacheDomflags(),this.domflagsPanel=void 0,this.panelList=void 0,this.shadowRoot=void 0,this.modifiedNodes=void 0,this.observer=void 0,this.flagStrings=[],this.observerVars={attributes:!0,attributeFilter:["domflag"],attributeOldValue:!1,childList:!0,subtree:!0},this.setupDomObserver(),this.backgroundListener()}return s.prototype._getXPath=function(t){var s,o,a;for(o="";;){if(t.nodeType!==e)break;s=$(t.parentNode).children(t.tagName).index(t)+1,a=s>1?"["+s+"]":"",o="/"+t.tagName.toLowerCase()+a+o,t=t.parentNode}return o},s.prototype._cacheDomflagsPanel=function(){return null!=this.shadowRoot?this.domflagsPanel=this.shadowRoot.getElementById("domflags-panel"):this.appendDomflagsPanel()},s.prototype._restorePersistedDomflags=function(){var e;return e={},e[location.origin]=[],chrome.storage.sync.get(e,function(e){var s,o,a,n,r,i;for(r=e[location.origin],i=[],a=0,n=r.length;n>a;a++)o=r[a],s=document.evaluate(o,document,null,t,null).singleNodeValue,i.push(s.setAttribute("domflag",""));return i})},s.prototype._cacheDomflags=function(){var e,t,s,o,a,n;for(this.domflags=document.querySelectorAll("[domflag]"),s=[],n=this.domflags,o=0,a=n.length;a>o;o++)e=n[o],s.push(this._getXPath(e));return t={},t[location.origin]=s,chrome.storage.sync.set(t)},s.prototype._calibrateIndexes=function(){var e,t,s,o,a,n;for(a=this._getPanelItems(),n=[],e=s=0,o=a.length;o>s;e=++s)t=a[e],n.push(t.setAttribute("data-key",e));return n},s.prototype._getPanelItems=function(){return this.domflagsPanel.getElementsByClassName("domflags-li")},s.prototype._addNodes=function(e){return this.panelList.appendChild(e)},s.prototype._positionNodes=function(e,t,s){return t>0?this.panelList.insertBefore(e,s[t-1].nextSibling):this.panelList.insertBefore(e,s[0])},s.prototype._createEl=function(e,t){var s;return s=document.createElement("domflags-li"),s.innerHTML=e,s.className="domflags-li",s.setAttribute("data-key",t),s},s.prototype._elToString=function(e){var t,s,o;return o=e.tagName.toLowerCase(),s=e.id?"#"+e.id:"",t=e.className?"."+e.className:"",o+s+t},s.prototype.backgroundListener=function(){return chrome.runtime.onMessage.addListener(function(e){return function(t){if("remove"===t){if(e.observer.disconnect(),null==e.domflagsPanel)return;e.domflagsPanel.parentNode.removeChild(e.domflagsPanel),e._cacheDomflagsPanel()}return"create"===t&&(e.observer.observe(document.body,e.observerVars),null==e.domflagsPanel&&(e._cacheDomflags(),e.domflags.length>0))?e.addNodesToPanel(e.domflags):void 0}}(this))},s.prototype.appendDomflagsPanel=function(){var e,t,s,o;return e=chrome.extension.getURL("src/inject/inject.css"),o='<style type="text/css" media="screen">@import url('+e+");</style>",t='<domflags-panel id="domflags-panel" class="bottom left opened">\n  <domflags-header class="domflags-header">DOMFLAGS</domflags-header>\n  <domflags-button class="domflags-button right"></domflags-button>\n  <domflags-ol class="domflags-ol"></domflags-ol>\n</domflags-panel>',null==document.getElementById("domflags-root")&&(s=document.createElement("domflags"),s.setAttribute("id","domflags-root"),document.body.appendChild(s,document.body.childNodes[0]),this.shadowRoot=document.getElementById("domflags-root").createShadowRoot(),this.shadowRoot.innerHTML=o),this.shadowRoot.innerHTML+=t,this._cacheDomflagsPanel(),this.panelList=this.domflagsPanel.getElementsByClassName("domflags-ol")[0],this.createPanelListeners()},s.prototype.createPanelListeners=function(){var e,t,s;return this.domflagsPanel.addEventListener("click",function(){return function(o){switch(o.target.classList[0]){case"domflags-li":return t(o);case"domflags-header":return e();case"domflags-button":return s(o)}}}(this)),t=function(e){var t;return t=e.target.getAttribute("data-key"),chrome.runtime.sendMessage({name:"panelClick",key:t})},e=function(e){return function(){var t,s,o,a;return t={remove:"opened",add:"closed",height:e.panelList.offsetHeight+1},o={remove:"closed",add:"opened",height:0},a=function(){switch(!1){case!this.domflagsPanel.classList.contains("opened"):return t;case!this.domflagsPanel.classList.contains("closed"):return o}}.call(e),s=a.height,e.domflagsPanel.classList.remove(a.remove),e.domflagsPanel.classList.add(a.add),e.domflagsPanel.style.webkitTransform="translateY("+s+"px)"}}(this),s=function(e){return function(t){var s,o;switch(o=t.target.classList[1]){case"left":s="right";break;case"right":s="left"}return e.domflagsPanel.classList.remove(s),e.domflagsPanel.classList.add(o),t.target.classList.remove(o),t.target.classList.add(s)}}(this)},s.prototype.addNodesToPanel=function(e){var t,s,o,a,n,r,i;for(null==this.domflagsPanel&&this.appendDomflagsPanel(),n=this._getPanelItems(),r=0,i=e.length;i>r;r++){if(a=e[r],!a.hasAttribute("domflag"))return;switch(s=this._elToString(a),this._cacheDomflags(),o=[].indexOf.call(this.domflags,a),this.flagStrings.splice(o,0,s),t=this._createEl(s,o),!1){case!(n.length>0):this._positionNodes(t,o,n);break;default:this._addNodes(t)}}return this._calibrateIndexes()},s.prototype.removeNodesFromPanel=function(e){var t,s,o,a,n,r,i;if(this._cacheDomflagsPanel(),null!=this.domflagsPanel){for(a=this._getPanelItems(),i=e.slice(0).reverse(),n=0,r=i.length;r>n;n++)s=i[n],t=[].indexOf.call(this.domflags,s),this.flagStrings.splice(t,1),o=a[t],null!=o&&o.parentNode.removeChild(o);return this._cacheDomflags(),this._calibrateIndexes()}},s.prototype.setupDomObserver=function(){return this.observer=new MutationObserver(function(e){return function(t){var s,o,a;for(e.modifiedNodes={"new":[],deleted:[]},o=0,a=t.length;a>o;o++)switch(s=t[o],s.type){case"childList":e.parseChildList(s);break;case"attributes":e.parseAttrs(s)}return e.modifiedNodes.deleted.length>0&&e.removeNodesFromPanel(e.modifiedNodes.deleted),e.modifiedNodes["new"].length>0?e.addNodesToPanel(e.modifiedNodes["new"]):void 0}}(this))},s.prototype.parseChildList=function(t){var s,a,n,r,i,l,d,c,f;if(s={mutation:t.addedNodes,panelArray:this.modifiedNodes["new"]},i={mutation:t.removedNodes,panelArray:this.modifiedNodes.deleted},n=function(){switch(!1){case!(s.mutation.length>0):return s;case!(i.mutation.length>0):return i}}(),r=function(e){return o.call(n.panelArray,e)<0?n.panelArray.push(e):void 0},null!=n){for(c=n.mutation,f=[],l=0,d=c.length;d>l;l++)a=c[l],a.nodeType===e&&(a.hasAttribute("domflag")&&r(a),f.push(function(){var e,t,s,o;for(s=a.querySelectorAll("[domflag]"),o=[],e=0,t=s.length;t>e;e++)a=s[e],o.push(r(a));return o}()));return f}},s.prototype.parseAttrs=function(e){return e.target.hasAttribute("domflag")?this.modifiedNodes["new"].push(e.target):this.modifiedNodes.deleted.push(e.target)},s}())}).call(this);