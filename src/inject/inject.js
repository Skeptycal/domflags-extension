(function(){var e=[].indexOf||function(e){for(var t=0,a=this.length;a>t;t++)if(t in this&&this[t]===e)return t;return-1};this.toggleDomflag=function(e){return e.hasAttribute("domflag")?e.removeAttribute("domflag",""):e.setAttribute("domflag","")},$(document).ready(function(){var t,a;return t=function(){function t(e){this.domflags=e,this.domflagsPanel=void 0,this.panelList=void 0,this.shadowRoot=void 0,this.flagStrings=[],this.backgroundListener(),this.setupDomObserver()}return t.prototype.backgroundListener=function(){return chrome.runtime.onMessage.addListener(function(e){return function(t){return"remove"===t&&(e.domflagsPanel.remove(),e.domflagsPanel=e.shadowRoot.getElementById("domflags-panel")),"create"===t&&e.domflags.length>0&&!e.domflagsPanel?e.addNodesToPanel(e.domflags):void 0}}(this))},t.prototype.appendDomflagsPanel=function(){var e,t,a;return e=chrome.extension.getURL("src/inject/inject.css"),a='<style type="text/css" media="screen">@import url('+e+");</style>",t='<domflags-panel id="domflags-panel" class="bottom left opened">\n  <domflags-header class="domflags-header">DOMFLAGS</domflags-header>\n  <domflags-button class="domflags-button right"></domflags-button>\n  <domflags-ol class="domflags-ol"></domflags-ol>\n</domflags-panel>',null==document.getElementById("domflags-root")&&($(document.body).append('<domflags id="domflags-root"></domflags>'),this.shadowRoot=document.querySelector("#domflags-root").createShadowRoot(),this.shadowRoot.innerHTML=a),this.shadowRoot.innerHTML+=t,this.domflagsPanel=this.shadowRoot.getElementById("domflags-panel"),this.panelList=this.domflagsPanel.querySelector(".domflags-ol"),this.createPanelListeners()},t.prototype.createPanelListeners=function(){return this.domflagsPanel.addEventListener("click",function(e){return function(t){var a,s,o,l;return"domflags-li"===t.target.className?(a=$(t.target).attr("data-key"),chrome.runtime.sendMessage({name:"panelClick",key:a})):"domflags-header"===t.target.className?(e.domflagsPanel.classList.contains("opened")?(s=$(e.panelList).outerHeight()+1,e.domflagsPanel.classList.remove("opened"),e.domflagsPanel.classList.add("closed")):e.domflagsPanel.classList.contains("closed")&&(s=0,e.domflagsPanel.classList.remove("closed"),e.domflagsPanel.classList.add("opened")),$(e.domflagsPanel).css("transform","translateY("+s+"px)")):"domflags-button"===t.target.classList[0]?(l=t.target.classList[1],"left"===l?o="right":"right"===l&&(o="left"),e.domflagsPanel.classList.remove(o),e.domflagsPanel.classList.add(l),t.target.classList.remove(l),t.target.classList.add(o)):void 0}}(this))},t.prototype.nodeListToArray=function(e){return Array.prototype.slice.call(e)},t.prototype.elToString=function(e){var t,a,s;return s=e.tagName.toLowerCase(),a=e.id?"#"+e.id:"",t=e.className?"."+e.className:"",s+a+t},t.prototype.cacheDomflags=function(){return this.domflags=document.querySelectorAll("[domflag]")},t.prototype.calibrateIndexes=function(){var e,t,a,s,o,l;for(a=this.panelList.getElementsByTagName("domflags-li"),l=[],e=s=0,o=a.length;o>s;e=++s)t=a[e],l.push(t.setAttribute("data-key",e));return l},t.prototype.addNodesToPanel=function(e){var t,a,s,o,l,n,r;for(e=this.nodeListToArray(e),null==this.domflagsPanel&&this.appendDomflagsPanel(),l=this.domflagsPanel.getElementsByClassName("domflags-li"),n=0,r=e.length;r>n;n++)o=e[n],a=this.elToString(o),o.hasAttribute("domflag")&&(this.cacheDomflags(),s=$(this.domflags).index(o),this.flagStrings.splice(s,0,a),t="<domflags-li class='domflags-li' data-key='"+s+"'>"+a+"</domflags-li>",l.length>0?s>=1?$(l[s-1]).after(t):$(l[0]).before(t):this.panelList.innerHTML+=t);return this.calibrateIndexes()},t.prototype.removeNodesFromPanel=function(e){var t,a,s,o,l,n;for(s=this.domflagsPanel.getElementsByClassName("domflags-li"),n=e.slice(0).reverse(),o=0,l=n.length;l>o;o++)a=n[o],t=$(this.domflags).index(a),this.flagStrings.splice(t,1),$(s[t]).remove();return this.cacheDomflags(),this.calibrateIndexes()},t.prototype.setupDomObserver=function(){var t,a;return a=new MutationObserver(function(t){return function(a){var s,o,l,n,r,i,d,m,g,f,c,u,h,p,y,v;for(r=[],l=[],g=0,u=a.length;u>g;g++)if(n=a[g],"childList"===n.type){if(s={mutation:n.addedNodes,panelArray:r},m={mutation:n.removedNodes,panelArray:l},d=function(){switch(!1){case!(s.mutation.length>0):return s;case!(m.mutation.length>0):return m;default:return void 0}}(),null==d)continue;for(y=d.mutation,f=0,h=y.length;h>f;f++)if(i=y[f],"#text"!==i.nodeName)for(i.hasAttribute("domflag")&&e.call(d.panelArray,i)<0&&d.panelArray.push(i),v=i.querySelectorAll("[domflag]"),c=0,p=v.length;p>c;c++)o=v[c],e.call(d.panelArray,o)<0&&d.panelArray.push(o)}else"attributes"===n.type&&(n.target.hasAttribute("domflag")?r.push(n.target):l.push(n.target));return l.length>0&&t.removeNodesFromPanel(l),r.length>0?t.addNodesToPanel(r):void 0}}(this)),t={attributes:!0,attributeFilter:["domflag"],attributeOldValue:!1,childList:!0,subtree:!0},a.observe(document.body,t)},t}(),a=document.querySelectorAll("[domflag]"),new t(a)})}).call(this);