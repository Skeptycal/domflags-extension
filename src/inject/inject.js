(function(){var e,t=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};this.toggleDomflag=function(e){return e.hasAttribute("domflag")?e.removeAttribute("domflag",""):e.setAttribute("domflag","")},e=function(){function e(e){this.domflags=e,this.domflagsPanel=void 0,this.panelList=void 0,this.shadowRoot=void 0,this.modifiedNodes=void 0,this.flagStrings=[],this.observerVars={attributes:!0,attributeFilter:["domflag"],attributeOldValue:!1,childList:!0,subtree:!0},this.backgroundListener(),this.domObserver().observe(document.body,this.observerVars)}return e.prototype._cacheDomflagsPanel=function(){return null!=this.shadowRoot?this.domflagsPanel=this.shadowRoot.getElementById("domflags-panel"):this.appendDomflagsPanel()},e.prototype._cacheDomflags=function(){return this.domflags=document.querySelectorAll("[domflag]")},e.prototype._calibrateIndexes=function(){var e,t,s,o,a,n;for(a=this._getPanelItems(),n=[],e=s=0,o=a.length;o>s;e=++s)t=a[e],n.push(t.setAttribute("data-key",e));return n},e.prototype._getPanelItems=function(){return this.domflagsPanel.getElementsByClassName("domflags-li")},e.prototype._elToString=function(e){var t,s,o;return o=e.tagName.toLowerCase(),s=e.id?"#"+e.id:"",t=e.className?"."+e.className:"",o+s+t},e.prototype.backgroundListener=function(){return chrome.runtime.onMessage.addListener(function(e){return function(t){return"remove"===t&&(e.domflagsPanel.parentNode.removeChild(e.domflagsPanel),e._cacheDomflagsPanel()),"create"===t&&null==e.domflagsPanel&&e.domflags.length>0?e.addNodesToPanel(e.domflags):void 0}}(this))},e.prototype.appendDomflagsPanel=function(){var e,t,s,o;return e=chrome.extension.getURL("src/inject/inject.css"),o='<style type="text/css" media="screen">@import url('+e+");</style>",t='<domflags-panel id="domflags-panel" class="bottom left opened">\n  <domflags-header class="domflags-header">DOMFLAGS</domflags-header>\n  <domflags-button class="domflags-button right"></domflags-button>\n  <domflags-ol class="domflags-ol"></domflags-ol>\n</domflags-panel>',null==document.getElementById("domflags-root")&&(s=document.createElement("domflags"),s.setAttribute("id","domflags-root"),document.body.appendChild(s,document.body.childNodes[0]),this.shadowRoot=document.getElementById("domflags-root").createShadowRoot(),this.shadowRoot.innerHTML=o),this.shadowRoot.innerHTML+=t,this._cacheDomflagsPanel(),this.panelList=this.domflagsPanel.getElementsByClassName("domflags-ol")[0],this.createPanelListeners()},e.prototype.createPanelListeners=function(){var e,t,s;return this.domflagsPanel.addEventListener("click",function(){return function(o){switch(o.target.classList[0]){case"domflags-li":return t(o);case"domflags-header":return e();case"domflags-button":return s(o)}}}(this)),t=function(e){var t;return t=e.target.getAttribute("data-key"),chrome.runtime.sendMessage({name:"panelClick",key:t})},e=function(e){return function(){var t,s,o,a;return t={remove:"opened",add:"closed",height:e.panelList.offsetHeight+1},o={remove:"closed",add:"opened",height:0},a=function(){switch(!1){case!this.domflagsPanel.classList.contains("opened"):return t;case!this.domflagsPanel.classList.contains("closed"):return o}}.call(e),s=a.height,e.domflagsPanel.classList.remove(a.remove),e.domflagsPanel.classList.add(a.add),$(e.domflagsPanel).css("transform","translateY("+s+"px)")}}(this),s=function(e){return function(t){var s,o;switch(o=t.target.classList[1]){case"left":s="right";break;case"right":s="left"}return e.domflagsPanel.classList.remove(s),e.domflagsPanel.classList.add(o),t.target.classList.remove(o),t.target.classList.add(s)}}(this)},e.prototype.addNodesToPanel=function(e){var t,s,o,a,n,r,l,i,d;for(r=function(e){return function(t){return e.panelList.innerHTML+=t}}(this),d=function(e,t){return t>0?$(n[t-1]).after(e):$(n[0]).before(e)},null==this.domflagsPanel&&this.appendDomflagsPanel(),n=this._getPanelItems(),l=0,i=e.length;i>l;l++){if(a=e[l],!a.hasAttribute("domflag"))return;switch(s=this._elToString(a),this._cacheDomflags(),o=[].indexOf.call(this.domflags,a),this.flagStrings.splice(o,0,s),t="<domflags-li class='domflags-li' data-key='"+o+"'>"+s+"</domflags-li>",!1){case!(n.length>0):d(t,o);break;default:r(t)}}return this._calibrateIndexes()},e.prototype.removeNodesFromPanel=function(e){var t,s,o,a,n,r,l;if(this._cacheDomflagsPanel(),null!=this.domflagsPanel){for(a=this._getPanelItems(),l=e.slice(0).reverse(),n=0,r=l.length;r>n;n++)s=l[n],t=[].indexOf.call(this.domflags,s),this.flagStrings.splice(t,1),o=a[t],null!=o&&o.parentNode.removeChild(o);return this._cacheDomflags(),this._calibrateIndexes()}},e.prototype.domObserver=function(){return new MutationObserver(function(e){return function(t){var s,o,a;for(e.modifiedNodes={"new":[],deleted:[]},o=0,a=t.length;a>o;o++)switch(s=t[o],s.type){case"childList":e.parseChildList(s);break;case"attributes":e.parseAttrs(s)}return e.modifiedNodes.deleted.length>0&&e.removeNodesFromPanel(e.modifiedNodes.deleted),e.modifiedNodes["new"].length>0?e.addNodesToPanel(e.modifiedNodes["new"]):void 0}}(this))},e.prototype.parseChildList=function(e){var s,o,a,n,r,l,i,d,f;if(s={mutation:e.addedNodes,panelArray:this.modifiedNodes["new"]},r={mutation:e.removedNodes,panelArray:this.modifiedNodes.deleted},a=function(){switch(!1){case!(s.mutation.length>0):return s;case!(r.mutation.length>0):return r}}(),n=function(e){return t.call(a.panelArray,e)<0?a.panelArray.push(e):void 0},null!=a){for(d=a.mutation,f=[],l=0,i=d.length;i>l;l++)o=d[l],"#text"!==o.nodeName&&(o.hasAttribute("domflag")&&n(o),f.push(function(){var e,t,s,a;for(s=o.querySelectorAll("[domflag]"),a=[],e=0,t=s.length;t>e;e++)o=s[e],a.push(n(o));return a}()));return f}},e.prototype.parseAttrs=function(e){return e.target.hasAttribute("domflag")?this.modifiedNodes["new"].push(e.target):this.modifiedNodes.deleted.push(e.target)},e}(),$(document).ready(function(){return new e(document.querySelectorAll("[domflag]"))})}).call(this);