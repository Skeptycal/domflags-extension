(function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};this.toggleDomflag=function(e){return e.hasAttribute("domflag")?e.removeAttribute("domflag",""):e.setAttribute("domflag","")},$(document).ready(function(){var t,s;return t=function(){function t(e){this.domflags=e,this.domflagsPanel=void 0,this.panelList=void 0,this.shadowRoot=void 0,this.modifiedNodes=void 0,this.flagStrings=[],this.configVars={attributes:!0,attributeFilter:["domflag"],attributeOldValue:!1,childList:!0,subtree:!0},this.backgroundListener(),this.setupDomObserver()}return t.prototype.backgroundListener=function(){return chrome.runtime.onMessage.addListener(function(e){return function(t){return"remove"===t&&(e.domflagsPanel.remove(),e.domflagsPanel=e.shadowRoot.getElementById("domflags-panel")),"create"===t&&e.domflags.length>0&&!e.domflagsPanel?e.addNodesToPanel(e.domflags):void 0}}(this))},t.prototype.appendDomflagsPanel=function(){var e,t,s;return e=chrome.extension.getURL("src/inject/inject.css"),s='<style type="text/css" media="screen">@import url('+e+");</style>",t='<domflags-panel id="domflags-panel" class="bottom left opened">\n  <domflags-header class="domflags-header">DOMFLAGS</domflags-header>\n  <domflags-button class="domflags-button right"></domflags-button>\n  <domflags-ol class="domflags-ol"></domflags-ol>\n</domflags-panel>',null==document.getElementById("domflags-root")&&($(document.body).append('<domflags id="domflags-root"></domflags>'),this.shadowRoot=document.querySelector("#domflags-root").createShadowRoot(),this.shadowRoot.innerHTML=s),this.shadowRoot.innerHTML+=t,this.domflagsPanel=this.shadowRoot.getElementById("domflags-panel"),this.panelList=this.domflagsPanel.querySelector(".domflags-ol"),this.createPanelListeners()},t.prototype.createPanelListeners=function(){return this.domflagsPanel.addEventListener("click",function(e){return function(t){var s,o,a,n;return"domflags-li"===t.target.className?(s=$(t.target).attr("data-key"),chrome.runtime.sendMessage({name:"panelClick",key:s})):"domflags-header"===t.target.className?(e.domflagsPanel.classList.contains("opened")?(o=$(e.panelList).outerHeight()+1,e.domflagsPanel.classList.remove("opened"),e.domflagsPanel.classList.add("closed")):e.domflagsPanel.classList.contains("closed")&&(o=0,e.domflagsPanel.classList.remove("closed"),e.domflagsPanel.classList.add("opened")),$(e.domflagsPanel).css("transform","translateY("+o+"px)")):"domflags-button"===t.target.classList[0]?(n=t.target.classList[1],"left"===n?a="right":"right"===n&&(a="left"),e.domflagsPanel.classList.remove(a),e.domflagsPanel.classList.add(n),t.target.classList.remove(n),t.target.classList.add(a)):void 0}}(this))},t.prototype.elToString=function(e){var t,s,o;return o=e.tagName.toLowerCase(),s=e.id?"#"+e.id:"",t=e.className?"."+e.className:"",o+s+t},t.prototype.cacheDomflags=function(){return this.domflags=document.querySelectorAll("[domflag]")},t.prototype.calibrateIndexes=function(){var e,t,s,o,a,n;for(s=this.panelList.getElementsByTagName("domflags-li"),n=[],e=o=0,a=s.length;a>o;e=++o)t=s[e],n.push(t.setAttribute("data-key",e));return n},t.prototype.addNodesToPanel=function(e){var t,s,o,a,n,l,r;for(null==this.domflagsPanel&&this.appendDomflagsPanel(),n=this.domflagsPanel.getElementsByClassName("domflags-li"),l=0,r=e.length;r>l;l++)a=e[l],s=this.elToString(a),a.hasAttribute("domflag")&&(this.cacheDomflags(),o=$(this.domflags).index(a),this.flagStrings.splice(o,0,s),t="<domflags-li class='domflags-li' data-key='"+o+"'>"+s+"</domflags-li>",n.length>0?o>=1?$(n[o-1]).after(t):$(n[0]).before(t):this.panelList.innerHTML+=t);return this.calibrateIndexes()},t.prototype.removeNodesFromPanel=function(e){var t,s,o,a,n,l;for(o=this.domflagsPanel.getElementsByClassName("domflags-li"),l=e.slice(0).reverse(),a=0,n=l.length;n>a;a++)s=l[a],t=$(this.domflags).index(s),this.flagStrings.splice(t,1),$(o[t]).remove();return this.cacheDomflags(),this.calibrateIndexes()},t.prototype.setupDomObserver=function(){var e;return e=new MutationObserver(function(e){return function(t){var s,o,a;for(e.modifiedNodes={"new":[],deleted:[]},o=0,a=t.length;a>o;o++)switch(s=t[o],s.type){case"childList":e.parseChildList(s);break;case"attributes":e.parseAttrs(s)}return e.modifiedNodes.deleted.length>0&&e.removeNodesFromPanel(e.modifiedNodes.deleted),e.modifiedNodes["new"].length>0?e.addNodesToPanel(e.modifiedNodes["new"]):void 0}}(this)),e.observe(document.body,this.configVars)},t.prototype.parseChildList=function(t){var s,o,a,n,l,r,i,d,m;if(s={mutation:t.addedNodes,panelArray:this.modifiedNodes["new"]},l={mutation:t.removedNodes,panelArray:this.modifiedNodes.deleted},a=function(){switch(!1){case!(s.mutation.length>0):return s;case!(l.mutation.length>0):return l}}(),n=function(t){return e.call(a.panelArray,t)<0?a.panelArray.push(t):void 0},null!=a){for(d=a.mutation,m=[],r=0,i=d.length;i>r;r++)o=d[r],"#text"!==o.nodeName&&(o.hasAttribute("domflag")&&n(o),m.push(function(){var e,t,s,a;for(s=o.querySelectorAll("[domflag]"),a=[],e=0,t=s.length;t>e;e++)o=s[e],a.push(n(o));return a}()));return m}},t.prototype.parseAttrs=function(e){return e.target.hasAttribute("domflag")?this.modifiedNodes["new"].push(e.target):this.modifiedNodes.deleted.push(e.target)},t}(),s=document.querySelectorAll("[domflag]"),new t(s)})}).call(this);